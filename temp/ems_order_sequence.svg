<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1100" width="1400" height="1100">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 22px; font-weight: bold; fill: #333; }
      .subtitle { font-family: Arial, sans-serif; font-size: 13px; fill: #666; }
      .actor-box { fill: #1976d2; stroke: #0d47a1; stroke-width: 2; }
      .actor-text { font-family: Arial, sans-serif; font-size: 13px; font-weight: bold; fill: #fff; text-anchor: middle; }
      .lifeline { stroke: #999; stroke-width: 2; stroke-dasharray: 5,5; }
      .activation { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
      .arrow { fill: none; stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); }
      .arrow-return { fill: none; stroke: #666; stroke-width: 2; stroke-dasharray: 5,3; marker-end: url(#arrowhead-return); }
      .arrow-label { font-family: Arial, sans-serif; font-size: 11px; fill: #333; }
      .step-num { font-family: Arial, sans-serif; font-size: 10px; font-weight: bold; fill: #d32f2f; }
      .note-box { fill: #fff9c4; stroke: #fbc02d; stroke-width: 1; }
      .note-text { font-family: Arial, sans-serif; font-size: 10px; fill: #333; }
      .time-label { font-family: Arial, sans-serif; font-size: 9px; fill: #666; font-style: italic; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-return" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="30" class="title" text-anchor="middle">Order Flow Sequence: PM Decision → Execution → Fill</text>
  <text x="700" y="50" class="subtitle" text-anchor="middle">End-to-End Timeline with Latency Targets</text>

  <!-- Actors -->
  <rect x="50" y="80" width="140" height="40" rx="5" class="actor-box"/>
  <text x="120" y="105" class="actor-text">Portfolio Manager</text>

  <rect x="240" y="80" width="140" height="40" rx="5" class="actor-box"/>
  <text x="310" y="105" class="actor-text">EMS GUI</text>

  <rect x="430" y="80" width="140" height="40" rx="5" class="actor-box"/>
  <text x="500" y="105" class="actor-text">Order Manager</text>

  <rect x="620" y="80" width="140" height="40" rx="5" class="actor-box"/>
  <text x="690" y="105" class="actor-text">Risk Engine</text>

  <rect x="810" y="80" width="140" height="40" rx="5" class="actor-box"/>
  <text x="880" y="105" class="actor-text">Execution Algo</text>

  <rect x="1000" y="80" width="140" height="40" rx="5" class="actor-box"/>
  <text x="1070" y="105" class="actor-text">FIX Gateway</text>

  <rect x="1190" y="80" width="140" height="40" rx="5" class="actor-box"/>
  <text x="1260" y="105" class="actor-text">Exchange</text>

  <!-- Lifelines -->
  <line x1="120" y1="120" x2="120" y2="1050" class="lifeline"/>
  <line x1="310" y1="120" x2="310" y2="1050" class="lifeline"/>
  <line x1="500" y1="120" x2="500" y2="1050" class="lifeline"/>
  <line x1="690" y1="120" x2="690" y2="1050" class="lifeline"/>
  <line x1="880" y1="120" x2="880" y2="1050" class="lifeline"/>
  <line x1="1070" y1="120" x2="1070" y2="1050" class="lifeline"/>
  <line x1="1260" y1="120" x2="1260" y2="1050" class="lifeline"/>

  <!-- Step 1: PM Decision -->
  <rect x="110" y="150" width="20" height="40" class="activation"/>
  <path class="arrow" d="M 130 170 L 300 170"/>
  <text x="215" y="165" class="arrow-label">Submit Order (Buy 10k AAPL @ Market)</text>
  <text x="30" y="170" class="step-num">1</text>
  <text x="30" y="185" class="time-label">T+0ms</text>

  <!-- Step 2: GUI validation -->
  <rect x="300" y="170" width="20" height="60" class="activation"/>
  <path class="arrow" d="M 320 190 L 490 190"/>
  <text x="405" y="185" class="arrow-label">Order Entry (GUI validation)</text>
  <text x="30" y="190" class="step-num">2</text>
  <text x="30" y="205" class="time-label">T+5ms</text>

  <!-- Step 3: Order Manager receives -->
  <rect x="490" y="190" width="20" height="180" class="activation"/>
  <path class="arrow" d="M 510 210 L 680 210"/>
  <text x="595" y="205" class="arrow-label">Pre-trade Risk Check</text>
  <text x="30" y="210" class="step-num">3</text>
  <text x="30" y="225" class="time-label">T+10ms</text>

  <!-- Step 4: Risk validation -->
  <rect x="680" y="210" width="20" height="80" class="activation"/>
  <text x="710" y="230" class="note-text">• Check position limits</text>
  <text x="710" y="245" class="note-text">• Verify buying power</text>
  <text x="710" y="260" class="note-text">• Restricted list lookup</text>
  <text x="710" y="275" class="note-text">• Duplicate detection</text>

  <path class="arrow-return" d="M 680 290 L 510 290"/>
  <text x="595" y="285" class="arrow-label">Risk Approved</text>
  <text x="30" y="290" class="step-num">4</text>
  <text x="30" y="305" class="time-label">T+15ms</text>

  <!-- Step 5: Route to Algo -->
  <path class="arrow" d="M 510 310 L 870 310"/>
  <text x="690" y="305" class="arrow-label">Route to VWAP Algo (30min window)</text>
  <text x="30" y="310" class="step-num">5</text>
  <text x="30" y="325" class="time-label">T+20ms</text>

  <!-- Step 6: Algo slicing -->
  <rect x="870" y="310" width="20" height="250" class="activation"/>
  <rect x="900" y="330" width="200" height="100" class="note-box"/>
  <text x="910" y="345" class="note-text" font-weight="bold">Algo Logic:</text>
  <text x="910" y="360" class="note-text">• Slice 10k into 20 child orders</text>
  <text x="910" y="375" class="note-text">• Each slice = 500 shares</text>
  <text x="910" y="390" class="note-text">• Schedule: 1 slice per 90s</text>
  <text x="910" y="405" class="note-text">• Price: limit @ mid - 1 tick</text>
  <text x="910" y="420" class="note-text">• Adaptive to volume spikes</text>

  <!-- Step 7: First child order -->
  <path class="arrow" d="M 890 450 L 1060 450"/>
  <text x="975" y="445" class="arrow-label">Child Order #1 (500 @ $150.50)</text>
  <text x="30" y="450" class="step-num">6</text>
  <text x="30" y="465" class="time-label">T+25ms</text>

  <!-- Step 8: FIX message to exchange -->
  <rect x="1060" y="450" width="20" height="120" class="activation"/>
  <path class="arrow" d="M 1080 470 L 1250 470"/>
  <text x="1165" y="465" class="arrow-label">FIX NewOrder (35=D)</text>
  <text x="30" y="470" class="step-num">7</text>
  <text x="30" y="485" class="time-label">T+26ms</text>

  <rect x="1120" y="490" width="160" height="60" class="note-box"/>
  <text x="1130" y="505" class="note-text" font-size="9">ClOrdID=ABC123-001</text>
  <text x="1130" y="518" class="note-text" font-size="9">Symbol=AAPL, Side=BUY</text>
  <text x="1130" y="531" class="note-text" font-size="9">Qty=500, Price=150.50</text>
  <text x="1130" y="544" class="note-text" font-size="9">TimeInForce=DAY</text>

  <!-- Step 9: Exchange Ack -->
  <rect x="1250" y="470" width="20" height="100" class="activation"/>
  <path class="arrow-return" d="M 1250 550 L 1080 550"/>
  <text x="1165" y="545" class="arrow-label">ExecutionReport (Ack)</text>
  <text x="30" y="550" class="step-num">8</text>
  <text x="30" y="565" class="time-label">T+28ms</text>

  <!-- Step 10: Ack propagation -->
  <path class="arrow-return" d="M 1060 570 L 890 570"/>
  <text x="975" y="565" class="arrow-label">Order Accepted</text>

  <path class="arrow-return" d="M 880 590 L 510 590"/>
  <text x="695" y="585" class="arrow-label">Update: LIVE (in book)</text>

  <path class="arrow-return" d="M 500 610 L 320 610"/>
  <text x="410" y="605" class="arrow-label">Status Update</text>

  <path class="arrow-return" d="M 310 630 L 130 630"/>
  <text x="220" y="625" class="arrow-label">Blotter: 0/10000 filled</text>
  <text x="30" y="630" class="step-num">9</text>
  <text x="30" y="645" class="time-label">T+35ms</text>

  <!-- Step 11: Market movement / Fill -->
  <rect x="1250" y="680" width="20" height="50" class="activation"/>
  <text x="1280" y="695" class="note-text">Market trades</text>
  <text x="1280" y="710" class="note-text">at $150.50</text>

  <path class="arrow-return" d="M 1250 730 L 1080 730"/>
  <text x="1165" y="725" class="arrow-label">ExecutionReport (Fill: 500 @ 150.50)</text>
  <text x="30" y="730" class="step-num">10</text>
  <text x="30" y="745" class="time-label">T+2.5sec</text>

  <!-- Step 12: Fill propagation -->
  <rect x="1060" y="730" width="20" height="40" class="activation"/>
  <path class="arrow-return" d="M 1060 770 L 890 770"/>
  <text x="975" y="765" class="arrow-label">Fill Notification</text>

  <rect x="870" y="770" width="20" height="60" class="activation"/>
  <path class="arrow-return" d="M 870 790 L 510 790"/>
  <text x="690" y="785" class="arrow-label">Update Parent: 500/10000 filled</text>

  <rect x="490" y="790" width="20" height="80" class="activation"/>
  <text x="520" y="810" class="note-text">• Aggregate fill</text>
  <text x="520" y="825" class="note-text">• Update position</text>
  <text x="520" y="840" class="note-text">• Calculate avg price</text>
  <text x="520" y="855" class="note-text">• Publish event</text>

  <path class="arrow-return" d="M 490 870 L 320 870"/>
  <text x="405" y="865" class="arrow-label">Fill Update</text>

  <rect x="300" y="870" width="20" height="40" class="activation"/>
  <path class="arrow-return" d="M 300 910 L 130 910"/>
  <text x="215" y="905" class="arrow-label">Blotter: 500/10000 filled @ 150.50</text>
  <text x="30" y="910" class="step-num">11</text>
  <text x="30" y="925" class="time-label">T+2.51sec</text>

  <!-- Step 13: Algo continues -->
  <rect x="870" y="950" width="20" height="40" class="activation"/>
  <text x="900" y="970" class="note-text">Algo schedules next slice...</text>
  <text x="900" y="985" class="note-text">(repeat steps 6-11 for remaining 9500 shares)</text>

  <!-- Timeline Summary -->
  <rect x="50" y="1020" width="1280" height="60" rx="5" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
  <text x="60" y="1040" class="note-text" font-weight="bold">Latency Summary:</text>
  <text x="70" y="1055" class="note-text">• PM Submit → Order Accepted: ~28ms (GUI+validation+routing+exchange ack)</text>
  <text x="70" y="1070" class="note-text">• First Fill arrival: ~2.5 seconds (depends on market liquidity and algo strategy)</text>
  <text x="800" y="1055" class="note-text">• Fill notification → Blotter update: &lt;5ms (critical for real-time P&amp;L)</text>
  <text x="800" y="1070" class="note-text">• Full order completion: ~30 minutes (VWAP algo timeframe)</text>

</svg>
